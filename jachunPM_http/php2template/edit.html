<?php
/**
 * The edit view of project module of ZenTaoPMS.
 *
 * @copyright   Copyright 2009-2015 青岛易软天创网络科技有限公司(QingDao Nature Easy Soft Network Technology Co,LTD, www.cnezsoft.com)
 * @license     ZPL (http://zpl.pub/page/zplv12.html)
 * @author      Chunsheng Wang <chunsheng@cnezsoft.com>
 * @package     project
 * @version     $Id: edit.html.php 4728 2013-05-03 06:14:34Z chencongzhi520@gmail.com $
 * @link        http://www.zentao.net
 */
?>
{{template "header.html" .}}
{{include '../../common/view/datepicker.html.php'}}
{{template "kindeditor.html" .}}
{{js_import (strAdd .Config.common.common.jsRoot "misc/date.js")}}
<div id='mainContent' class='main-content'>
  <div class='center-block'>
    <div class='main-header'>
      <h2>
        <span class='prefix label-id'><strong>{{$project->id}}</strong></span>
        {{html_a (helper_createLink 'project' "view"  'project=' . $project->id)  $project->name, '_blank'}}
        <small>{{.Lang.arrow . ' ' . .Lang.project.edit}}</small>
      </h2>
    </div>
    <form class='load-indicator main-form form-ajax' method='post' target='hiddenwin' id='dataform'>
      <table class='table table-form'>
        <tr>
          <th>{{.Lang.project.name}}</th>
          <td>{{html_input "name"  $project->name  "class='form-control' autocomplete='off' required"}}</td><td></td>
        </tr>
        <tr>
          <th>{{.Lang.project.code}}</th>
          <td>{{html_input "code"  $project->code  "class='form-control' autocomplete='off' required"}}</td>
        </tr>
        <tr>
          <th>{{.Lang.project.dateRange}}</th>
          <td>
            <div class='input-group'>
              {{html_input "begin"  $project->begin  "class='form-control form-date' onchange='computeWorkDays(' required placeholder='" . .Lang.project.begin . "'")}}
              <span class='input-group-addon fix-border'>{{.Lang.project.to}}</span>
              {{html_input "end"  $project->end  "class='form-control form-date' onchange='computeWorkDays(' required placeholder='" . .Lang.project.end . "'")}}
              <div class='input-group-btn'>
                <button type='button' class='btn dropdown-toggle' data-toggle='dropdown'>{{.Lang.project.byPeriod}} <span class='caret'></span></button>
                <ul class='dropdown-menu'>
                  {{foreach (.Lang.project.endList as $key => $name):}}
                  <li><a href='javascript:computeEndDate("{{$key}}")'>{{$name}}</a></li>
                  {{end}}
                </ul>
              </div>
            </div>
          </td>
        </tr>
        <tr>
          <th>{{.Lang.project.days}}</th>
          <td>
            <div class='input-group'>
              {{html_input "days"  $project->days  "class='form-control' autocomplete='off'"}}
              <span class='input-group-addon'>{{.Lang.project.day}}</span>
            </div>
          </td>
        </tr>
        <tr>
          <th>{{.Lang.project.type}}</th>
          <td>{{html_select "type"  .Lang.project.typeList  $project->type  "class='form-control'"}}</td>
        </tr>
        <tr>
          <th>{{.Lang.project.teamname}}</th>
          <td>{{html_input "team"  $project->team  "class='form-control' autocomplete='off'"}}</td>
        </tr>
        <tr>
          <th>{{.Lang.project.status}}</th>
          <td>{{html_select "status"  .Lang.project.statusList  $project->status  "class='form-control'"}}</td>
        </tr>
        {{if eq .Config.global.flow "onlyTask"}}
        <tr>
          <th>{{.Lang.project.owner}}</th>
          <td>{{html_select "PM"  $pmUsers  $project->PM  "class='form-control chosen'"}}</td>
        </tr>
        {{else}}
        <tr>
          <th rowspan='2'>{{.Lang.project.owner}}</th>
          <td>
            <div class='input-group'>
              <span class='input-group-addon'>{{.Lang.project.PO}}</span>
              {{html_select "PO"  $poUsers  $project->PO  "class='form-control chosen'"}}
            </div>
          </td>
          <td>
            <div class='input-group'>
              <span class='input-group-addon'>{{.Lang.project.QD}}</span>
              {{html_select "QD"  $qdUsers  $project->QD  "class='form-control chosen'"}}
            </div>
          </td>
        </tr>
        <tr>
          <td>
            <div class='input-group'>
              <span class='input-group-addon'>{{.Lang.project.PM}}</span>
              {{html_select "PM"  $pmUsers  $project->PM  "class='form-control chosen'"}}
            </div>
          </td>
          <td>
            <div class='input-group'>
              <span class='input-group-addon'>{{.Lang.project.RD}}</span>
              {{html_select "RD"  $rdUsers  $project->RD  "class='form-control chosen'"}}
            </div>
          </td>
        </tr>
        {{end}}
        <tr {{if .Config.global.flow == 'onlyTask') "class='hidden'"}}>
          <th>{{.Lang.project.manageProducts}}</th>
          <td class='text-left' id='productsBox' colspan="2">
            <div class='row'>
              {{$i = 0}}
              {{foreach($linkedProducts as $product}}
              <div class='col-sm-4'>
                {{$hasBranch = (ne product->type "normal") and isset($branchGroups[$product->id])}}
                <div class="input-group{{if $hasBranch) ' has-branch'}}">
                  {{html_select "products[$i]"  $allProducts  $product->id  "class='form-control chosen' onchange='loadBranches(this' data-last='" . $product->id . "'")}}
                  <span class='input-group-addon fix-border'></span>
                  {{if($hasBranch) html_select "branch[$i]"  $branchGroups[$product->id]  $product->branch  "class='form-control chosen' onchange=\"loadPlans('#products{$i}', this.value\"")}} 
                </div>
              </div>
              {{$i++}}
              {{end}}
              <div class='col-sm-4'>
                <div class='input-group'>
                  {{html_select "products[$i]"  $allProducts ""  "class='form-control chosen' onchange='loadBranches(this'")}}
                  <span class='input-group-addon fix-border'></span>
                </div>
              </div>
            </div>
          </td>
        </tr>
        <tr {{if(.Config.global.flow == 'onlyTask') "class='hidden'"}}>
          <th>{{.Lang.project.linkPlan}}</th>
          <td id="plansBox" colspan="2">
            <div class='row'>
              {{$i = 0}}
              {{foreach($linkedProducts as $product}}
              {{$plans = zget($productPlans, $product->id, array(0 => ''))}}
              <div class="col-sm-4" id="plan{{$i}}">{{html_select "plans[" . $product->id . "]"  $plans  $product->plan  "class='form-control chosen'"}}</div>
              {{$i++}}
              {{end}}
            </div>
          </td>
        </tr>
        <tr>
          <th>{{.Lang.project.desc}}</th>
          <td colspan='2'>{{html_textarea "desc"  htmlspecialchars($project->desc)  "rows='6' class='form-control kindeditor' hidefocus='true'"}}</td>
        </tr>
         <tr>
          <th>{{.Lang.files}}</th>
          <td colspan='3'>{{$this->fetch('file', 'buildform', array('fileCount' => '1', 'percent' => '0.9','filesName'=>'files','labelsName'=>'labels','examine'=>'','action'=>'project'))}}</td>
        </tr>
        <tr>
          <th>{{.Lang.project.acl}}</th>
          <td colspan='2'>{{nl2br(html_radio "acl"  .Lang.project.aclList  $project->acl  "onclick='setWhite(this.value'", 'block'))}}</td>
        </tr>
        <tr>
          <th>{{.Lang.project.ftpPath}}</th>
          <td>{{html_input "ftpPath"  $project->ftpPath  "class='form-control' autocomplete='off' required"}}</td>
        </tr>
        <tr id='whitelistBox' {{if((ne project->acl "custom")) "class='hidden'"}}>
          <th>{{.Lang.project.whitelist}}</th>
          <td colspan='2'>{{html_checkbox "whitelist"  $groups  $project->whitelist "', '', 'inline"}}</td>
        </tr>
        <tr><td colspan='3' class='text-center form-actions'>{{html::submitButton() . ' ' . html::backButton()}}</td></tr>
      </table>
    </form>
  </div>
</div>
{{js_set "weekend"  .Config.project.weekend}}
{{js_set "errorSameProducts"  .Lang.project.errorSameProducts}}
{{template "footer.html" .}}
